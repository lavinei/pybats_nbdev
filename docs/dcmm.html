---

title: DCMM

keywords: fastai
sidebar: home_sidebar

summary: "The class DCMM, for a Dynamic Count Mixture Model, which is the combination of a Bernoulli and Poisson DGLM, as described in <a href='https://arxiv.org/pdf/1805.05232.pdf'>Berry and West (2019)</a>."
description: "The class DCMM, for a Dynamic Count Mixture Model, which is the combination of a Bernoulli and Poisson DGLM, as described in <a href='https://arxiv.org/pdf/1805.05232.pdf'>Berry and West (2019)</a>."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/11_dcmm.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="dcmm" class="doc_header"><code>class</code> <code>dcmm</code><a href="https://github.com/lavinei/pybats_nbdev/tree/master/pybats_nbdev/dcmm.py#L14" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>dcmm</code>(<strong><code>a0_bern</code></strong>=<em><code>None</code></em>, <strong><code>R0_bern</code></strong>=<em><code>None</code></em>, <strong><code>nregn_bern</code></strong>=<em><code>0</code></em>, <strong><code>ntrend_bern</code></strong>=<em><code>0</code></em>, <strong><code>nlf_bern</code></strong>=<em><code>0</code></em>, <strong><code>nhol_bern</code></strong>=<em><code>0</code></em>, <strong><code>seasPeriods_bern</code></strong>=<em><code>[]</code></em>, <strong><code>seasHarmComponents_bern</code></strong>=<em><code>[]</code></em>, <strong><code>deltrend_bern</code></strong>=<em><code>1</code></em>, <strong><code>delregn_bern</code></strong>=<em><code>1</code></em>, <strong><code>delhol_bern</code></strong>=<em><code>1</code></em>, <strong><code>delseas_bern</code></strong>=<em><code>1</code></em>, <strong><code>dellf_bern</code></strong>=<em><code>1</code></em>, <strong><code>a0_pois</code></strong>=<em><code>None</code></em>, <strong><code>R0_pois</code></strong>=<em><code>None</code></em>, <strong><code>nregn_pois</code></strong>=<em><code>0</code></em>, <strong><code>ntrend_pois</code></strong>=<em><code>0</code></em>, <strong><code>nlf_pois</code></strong>=<em><code>0</code></em>, <strong><code>nhol_pois</code></strong>=<em><code>0</code></em>, <strong><code>seasPeriods_pois</code></strong>=<em><code>[]</code></em>, <strong><code>seasHarmComponents_pois</code></strong>=<em><code>[]</code></em>, <strong><code>deltrend_pois</code></strong>=<em><code>1</code></em>, <strong><code>delregn_pois</code></strong>=<em><code>1</code></em>, <strong><code>delhol_pois</code></strong>=<em><code>1</code></em>, <strong><code>delseas_pois</code></strong>=<em><code>1</code></em>, <strong><code>dellf_pois</code></strong>=<em><code>1</code></em>, <strong><code>rho</code></strong>=<em><code>1</code></em>, <strong><code>interpolate</code></strong>=<em><code>True</code></em>, <strong><code>adapt_discount</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A DCMM can be used in the same way as a DGLM, with the standard methods <a href="/pybats_nbdev/dcmm#dcmm.update"><code>dcmm.update</code></a>, <a href="/pybats_nbdev/dcmm#dcmm.forecast_marginal"><code>dcmm.forecast_marginal</code></a>, and <a href="/pybats_nbdev/dcmm#dcmm.forecast_path"><code>dcmm.forecast_path</code></a>. There are equivalent helper functions as well. A full analysis can be run with <a href="/pybats_nbdev/analysis#analysis_dcmm"><code>analysis_dcmm</code></a>, and <a href="/pybats_nbdev/define_models#define_dcmm"><code>define_dcmm</code></a> helps to initialize a DCMM. These helper functions assume that the same predictors <code>X</code> are used for the Bernoulli and Poisson DGLMs.</p>
<p>A quick example of using <code>analysis_dglm</code> follows:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">pybats_nbdev.shared</span> <span class="kn">import</span> <span class="n">load_sales_example2</span>
<span class="kn">from</span> <span class="nn">pybats_nbdev.analysis</span> <span class="kn">import</span> <span class="n">analysis_dcmm</span>
<span class="kn">from</span> <span class="nn">pandas.tseries.holiday</span> <span class="kn">import</span> <span class="n">USFederalHolidayCalendar</span>


<span class="n">data</span> <span class="o">=</span> <span class="n">load_sales_example2</span><span class="p">()</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Sales</th>
      <th>Price</th>
      <th>Promotion</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2014-06-01</th>
      <td>15.0</td>
      <td>1.11</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2014-06-02</th>
      <td>13.0</td>
      <td>2.19</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2014-06-03</th>
      <td>6.0</td>
      <td>0.23</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2014-06-04</th>
      <td>2.0</td>
      <td>-0.05</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2014-06-05</th>
      <td>6.0</td>
      <td>-0.14</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">prior_length</span> <span class="o">=</span> <span class="mi">25</span>   <span class="c1"># Number of days of data used to set prior</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">7</span>               <span class="c1"># Forecast horizon</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mf">0.5</span>           <span class="c1"># Random effect discount factor to increase variance of forecast distribution</span>
<span class="n">forecast_samps</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># Number of forecast samples to draw</span>
<span class="n">forecast_start</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">)</span> <span class="c1"># Date to start forecasting</span>
<span class="n">forecast_end</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2018-05-01&#39;</span><span class="p">)</span>   <span class="c1"># Date to stop forecasting</span>
<span class="n">holidays</span> <span class="o">=</span> <span class="n">USFederalHolidayCalendar</span><span class="o">.</span><span class="n">rules</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mod</span><span class="p">,</span> <span class="n">samples</span> <span class="o">=</span> <span class="n">analysis_dcmm</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;Price&#39;</span><span class="p">,</span> <span class="s1">&#39;Promotion&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                             <span class="n">k</span><span class="p">,</span> <span class="n">forecast_start</span><span class="p">,</span> <span class="n">forecast_end</span><span class="p">,</span>
                             <span class="n">nsamps</span><span class="o">=</span><span class="n">forecast_samps</span><span class="p">,</span>
                             <span class="n">prior_length</span><span class="o">=</span><span class="n">prior_length</span><span class="p">,</span>
                             <span class="n">seasPeriods</span><span class="o">=</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">seasHarmComponents</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]],</span>
                             <span class="n">dates</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">holidays</span><span class="o">=</span><span class="n">holidays</span><span class="p">,</span>
                             <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span>
                             <span class="n">ret</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;forecast&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>beginning forecasting
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Because the DCMM is effectively a container for a Poisson and a Bernoulli DGLM, we can access each of them individually. The coefficients in the Bernoulli DGLM affect the probability of a non-zero observation, and the coefficient in the Poisson DGLM impact the size of any non-zero observations. To illustrate, we'll take a look at the holiday coefficients in both DGLMs.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">coef</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Holidays&#39;</span><span class="p">:[</span><span class="n">h</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">holidays</span><span class="p">],</span>
                     <span class="s1">&#39;Pois Mean&#39;</span><span class="p">:</span> <span class="n">mod</span><span class="o">.</span><span class="n">pois_mod</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">mod</span><span class="o">.</span><span class="n">pois_mod</span><span class="o">.</span><span class="n">ihol</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                     <span class="s1">&#39;Pois Std Dev&#39;</span><span class="p">:</span> <span class="n">mod</span><span class="o">.</span><span class="n">pois_mod</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()[</span><span class="n">mod</span><span class="o">.</span><span class="n">pois_mod</span><span class="o">.</span><span class="n">ihol</span><span class="p">],</span>
                     <span class="s1">&#39;Bern Mean&#39;</span><span class="p">:</span> <span class="n">mod</span><span class="o">.</span><span class="n">bern_mod</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">mod</span><span class="o">.</span><span class="n">bern_mod</span><span class="o">.</span><span class="n">ihol</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                     <span class="s1">&#39;Bern Std Dev&#39;</span><span class="p">:</span> <span class="n">mod</span><span class="o">.</span><span class="n">bern_mod</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()[</span><span class="n">mod</span><span class="o">.</span><span class="n">bern_mod</span><span class="o">.</span><span class="n">ihol</span><span class="p">]})</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">coef</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Holidays</th>
      <th>Pois Mean</th>
      <th>Pois Std Dev</th>
      <th>Bern Mean</th>
      <th>Bern Std Dev</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>New Years Day</td>
      <td>-0.94</td>
      <td>0.44</td>
      <td>-0.74</td>
      <td>1.66</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Martin Luther King Jr. Day</td>
      <td>0.20</td>
      <td>0.18</td>
      <td>0.08</td>
      <td>2.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Presidents Day</td>
      <td>-0.27</td>
      <td>0.21</td>
      <td>0.27</td>
      <td>1.94</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Memorial Day</td>
      <td>0.65</td>
      <td>0.29</td>
      <td>0.03</td>
      <td>2.00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>July 4th</td>
      <td>1.10</td>
      <td>0.19</td>
      <td>0.04</td>
      <td>2.00</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Labor Day</td>
      <td>0.21</td>
      <td>0.18</td>
      <td>0.03</td>
      <td>2.00</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Columbus Day</td>
      <td>-0.05</td>
      <td>0.21</td>
      <td>0.21</td>
      <td>1.95</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Veterans Day</td>
      <td>-0.15</td>
      <td>0.23</td>
      <td>0.03</td>
      <td>2.00</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Thanksgiving</td>
      <td>0.13</td>
      <td>0.19</td>
      <td>0.16</td>
      <td>1.94</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Christmas</td>
      <td>-1.97</td>
      <td>1.22</td>
      <td>-1.09</td>
      <td>1.50</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The largest negative coefficients are for Christmas and New Years Day, which means that both are more likely to have $0$ sales, or very low sales. The largest positive coefficients are for July 4th and Memorial day, which means that they are likely to have increased sales.</p>

</div>
</div>
</div>
</div>
 

