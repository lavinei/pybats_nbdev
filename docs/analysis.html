---

title: analysis

keywords: fastai
sidebar: home_sidebar

summary: "This module contains the primary helper function to run a full standard time series analysis."
description: "This module contains the primary helper function to run a full standard time series analysis."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/05_analysis.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Analysis-for-a-DGLM">Analysis for a DGLM<a class="anchor-link" href="#Analysis-for-a-DGLM"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="analysis" class="doc_header"><code>analysis</code><a href="https://github.com/lavinei/pybats_nbdev/tree/master/pybats_nbdev/analysis.py#L15" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>analysis</code>(<strong><code>Y</code></strong>, <strong><code>X</code></strong>, <strong><code>k</code></strong>, <strong><code>forecast_start</code></strong>, <strong><code>forecast_end</code></strong>, <strong><code>nsamps</code></strong>=<em><code>500</code></em>, <strong><code>family</code></strong>=<em><code>'normal'</code></em>, <strong><code>n</code></strong>=<em><code>None</code></em>, <strong><code>model_prior</code></strong>=<em><code>None</code></em>, <strong><code>prior_length</code></strong>=<em><code>20</code></em>, <strong><code>ntrend</code></strong>=<em><code>1</code></em>, <strong><code>dates</code></strong>=<em><code>None</code></em>, <strong><code>holidays</code></strong>=<em><code>[]</code></em>, <strong><code>seasPeriods</code></strong>=<em><code>[]</code></em>, <strong><code>seasHarmComponents</code></strong>=<em><code>[]</code></em>, <strong><code>latent_factor</code></strong>=<em><code>None</code></em>, <strong><code>new_latent_factors</code></strong>=<em><code>None</code></em>, <strong><code>ret</code></strong>=<em><code>['model', 'forecast']</code></em>, <strong><code>mean_only</code></strong>=<em><code>False</code></em>, <strong><code>forecast_path</code></strong>=<em><code>False</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>This is a helpful function to run a standard analysis. The function will:</p>
<ol>
<li>Automatically initialize a DGLM</li>
<li>Run sequential updating</li>
<li>Forecast at each specified time step</li>
</ol>
<p>This function has many arguments to specify the model components. Here's a simple example for a Poisson DGLM:</p>
<p>.. code::</p>

<pre><code>mod, samples = analysis(Y, X, family="poisson",
                        forecast_start=15,      # First time step to forecast on
                        forecast_end=20,        # Final time step to forecast on
                        k=1,                    # Forecast horizon. If k&gt;1, default is to forecast 1:k steps ahead, marginally
                        prior_length=6,         # Number of observations to use in defining prior
                        rho=.5,                 # Random effect extension, increases variance of Poisson DGLM (see Berry and West, 2019)
                        deltrend=0.95,          # Discount factor on the trend component (intercept)
                        delregn=0.95            # Discount factor on the regression component
                        )


</code></pre>
<p>:param Y: Array of observations (n <em> 1)
:param X: Array of covariates (n </em> p)
:param k: forecast horizon (how many days ahead to forecast)
:param forecast_start: date or index value to start forecasting (beginning with 0).
:param forecast_end: date or index value to end forecasting
:param family: Exponential family for Y. Options: 'normal', 'poisson', 'bernoulli', or 'binomial'
:param nsamps: Number of forecast samples to draw
:param n: If family is 'binomial', this is a (n <em> 1) array of test size (where Y is the array of successes)
:param model_prior: A prespecified model of class DGLM
:param prior_length: If model_prior is not given, a DGLM will be defined using the first 'prior_length' observations in Y, X.
:param ntrend: Number of trend components in the model. 1 = local intercept , 2 = local intercept + local level
:param dates: Array of dates (n </em> 1). Must be specified if forecast_start and forecast_end are dates.
:param holidays: List of Holidays to be given a special indicator (from pandas.tseries.holiday)
:param seasPeriods: A list of periods for seasonal effects (e.g. [7] for a weekly effect, where Y is daily data)
:param seasHarmComponents: A list of lists of harmonic components for a seasonal period (e.g. [[1,2,3]] if seasPeriods=[7])
:param ret: A list of values to return. Options include: ['model', 'forecast, 'model_coef']
:param mean_only: True/False - return the mean only when forecasting, instead of samples?
:param kwargs: Further key word arguments to define the model prior. Common arguments include discount factors deltrend, delregn, delseas, and delhol.</p>
<p>:return: Default is a list with [model, forecast_samples]. forecast_samples will have dimension (nsamps by forecast_length by k), where forecast_length is the number of time steps between forecast_start and forecast_end. The output can be customized with the 'ret' parameter, which is a list of objects to return.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Analysis-for-a-DCMM">Analysis for a DCMM<a class="anchor-link" href="#Analysis-for-a-DCMM"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="analysis_dcmm" class="doc_header"><code>analysis_dcmm</code><a href="https://github.com/lavinei/pybats_nbdev/tree/master/pybats_nbdev/analysis.py#L222" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>analysis_dcmm</code>(<strong><code>Y</code></strong>, <strong><code>X</code></strong>, <strong><code>prior_length</code></strong>, <strong><code>k</code></strong>, <strong><code>forecast_start</code></strong>, <strong><code>forecast_end</code></strong>, <strong><code>nsamps</code></strong>=<em><code>500</code></em>, <strong><code>rho</code></strong>=<em><code>0.6</code></em>, <strong><code>latent_factor</code></strong>=<em><code>None</code></em>, <strong><code>mean_only</code></strong>=<em><code>False</code></em>, <strong><code>dates</code></strong>=<em><code>None</code></em>, <strong><code>holidays</code></strong>=<em><code>[]</code></em>, <strong><code>seasPeriods</code></strong>=<em><code>[]</code></em>, <strong><code>seasHarmComponents</code></strong>=<em><code>[]</code></em>, <strong><code>ret</code></strong>=<em><code>['forecast']</code></em>, <strong><code>new_latent_factors</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Run updating + forecasting using a dcmm. Latent Factor option available</p>
<p>:param Y: Array of daily sales (n <em> 1)
:param X: Covariate array (n </em> p)
:param prior_length: number of datapoints to use for prior specification
:param k: forecast horizon (how many days ahead to forecast)
:param forecast_start: day to start forecasting (beginning with 0)
:param forecast_end:  day to end forecasting
:param nsamps: Number of forecast samples to draw
:param rho: Random effect extension to the Poisson DGLM, handles overdispersion
:param phi_mu_prior: Mean of latent factors over k-step horizon (if using a Latent Factor DCMM)
:param phi_sigma_prior: Variance of latent factors over k-step horizon (if using a Latent Factor DCMM)
:param phi_psi_prior: Covariance of latent factors over k-step horizon (if using a Latent Factor DCMM)
:param phi_mu_post: Daily mean of latent factors for updating (if using a Latent Factor DCMM)
:param phi_sigma_post: Daily variance of latent factors for updating (if using a Latent Factor DCMM)
:param holidays: List of holiday dates
:param kwargs: Other keyword arguments for initializing the model. e.g. delregn = [.99, .98] discount factors.
:return: Array of forecasting samples, dimension (nsamps <em> (forecast_end - forecast_start) </em> k)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Analysis-for-a-DBCM">Analysis for a DBCM<a class="anchor-link" href="#Analysis-for-a-DBCM"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="analysis_dbcm" class="doc_header"><code>analysis_dbcm</code><a href="https://github.com/lavinei/pybats_nbdev/tree/master/pybats_nbdev/analysis.py#L384" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>analysis_dbcm</code>(<strong><code>Y_transaction</code></strong>, <strong><code>X_transaction</code></strong>, <strong><code>Y_cascade</code></strong>, <strong><code>X_cascade</code></strong>, <strong><code>excess</code></strong>, <strong><code>prior_length</code></strong>, <strong><code>k</code></strong>, <strong><code>forecast_start</code></strong>, <strong><code>forecast_end</code></strong>, <strong><code>nsamps</code></strong>=<em><code>500</code></em>, <strong><code>rho</code></strong>=<em><code>0.6</code></em>, <strong><code>latent_factor</code></strong>=<em><code>None</code></em>, <strong><code>mean_only</code></strong>=<em><code>False</code></em>, <strong><code>dates</code></strong>=<em><code>None</code></em>, <strong><code>holidays</code></strong>=<em><code>[]</code></em>, <strong><code>seasPeriods</code></strong>=<em><code>[]</code></em>, <strong><code>seasHarmComponents</code></strong>=<em><code>[]</code></em>, <strong><code>ret</code></strong>=<em><code>['forecast']</code></em>, <strong><code>new_latent_factors</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<h1 id="Run-updating-+-forecasting-using-a-dcmm.-Latent-Factor-option-available">Run updating + forecasting using a dcmm. Latent Factor option available<a class="anchor-link" href="#Run-updating-+-forecasting-using-a-dcmm.-Latent-Factor-option-available"> </a></h1><p>:param Y_transaction: Array of daily transactions (n <em> 1)
:param X_transaction: Covariate array (n </em> p)
:param Y_cascade: Array of daily baskets of size r or greater, for 1 &lt;= r &lt;= ncascade
:param X_cascade: Covariate array for the binomial DGLMs of the cascade
:param prior_length: number of datapoints to use for prior specification
:param k: forecast horizon (how many days ahead to forecast)
:param forecast_start: day to start forecasting (beginning with 0)
:param forecast_end:  day to end forecasting
:param nsamps: Number of forecast samples to draw
:param rho: Random effect extension to the Poisson DGLM, handles overdispersion
:param phi_mu_prior: Mean of latent factors over k-step horizon (if using a Latent Factor DCMM)
:param phi_sigma_prior: Variance of latent factors over k-step horizon (if using a Latent Factor DCMM)
:param phi_psi_prior: Covariance of latent factors over k-step horizon (if using a Latent Factor DCMM)
:param phi_mu_post: Daily mean of latent factors for updating (if using a Latent Factor DCMM)
:param phi_sigma_post: Daily variance of latent factors for updating (if using a Latent Factor DCMM)
:param kwargs: Other keyword arguments for initializing the model
:return: Array of forecasting samples, dimension (nsamps <em> (forecast_end - forecast_start) </em> k)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

