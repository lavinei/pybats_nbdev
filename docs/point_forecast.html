---

title: Point Forecasts

keywords: fastai
sidebar: home_sidebar

summary: "Functions to find point forecasts using a random sample of simulated values from the forecast distribution."
description: "Functions to find point forecasts using a random sample of simulated values from the forecast distribution."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/07_point_forecast.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Forecast samples are one element of the output from an analysis. They are created by sequentially simulating from the forecast distribution at each time step. The forecast samples are placed in a 3 dimensional array, whose axes are <em>nsamps</em> by <em>forecast length</em> by <em>k</em>, where:</p>
<ul>
<li><strong>nsamps</strong> is the number of samples drawn from the forecast distribution</li>
<li><strong>forecast length</strong> is the number of time steps between <code>forecast_start</code> and <code>forecast_end</code> in <a href="/pybats_nbdev/analysis"><code>analysis</code></a></li>
<li><strong>k</strong> is the forecast horizon, or the number of steps that were forecast ahead</li>
</ul>
<p>The point forecast will be calculated over <em>nsamps</em>, meaning that the output will be a 2 dimensional array of size <em>forecast length</em> by <em>k</em>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>NOTE: This module assumes that samples come as 3-dimensional arrays. This is typical output from analysis function. The first dimension should have independent forecast samples</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mean" class="doc_header"><code>mean</code><a href="https://github.com/lavinei/pybats_nbdev/tree/master/pybats_nbdev/point_forecast.py#L12" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mean</code>(<strong><code>samps</code></strong>)</p>
</blockquote>
<p>Return the mean point forecasts, given samples from the analysis function.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The mean point forecast is theoretically optimal for minimizing squared error loss, $\sum_i (y_i - f_i)^2$.</p>
<p>An example below demonstrates how to use the function:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pybats_nbdev.shared</span> <span class="kn">import</span> <span class="n">load_us_inflation</span>
<span class="kn">from</span> <span class="nn">pybats_nbdev.analysis</span> <span class="kn">import</span> <span class="n">analysis</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">load_us_inflation</span><span class="p">()</span>

<span class="n">forecast_start</span> <span class="o">=</span> <span class="s1">&#39;2000-Q1&#39;</span>
<span class="n">forecast_end</span> <span class="o">=</span> <span class="s1">&#39;2013-Q4&#39;</span>

<span class="n">mod</span><span class="p">,</span> <span class="n">samples</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">(</span><span class="n">Y</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Inflation</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span>
                        <span class="n">k</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">prior_length</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
                        <span class="n">forecast_start</span> <span class="o">=</span> <span class="n">forecast_start</span><span class="p">,</span> <span class="n">forecast_end</span> <span class="o">=</span> <span class="n">forecast_end</span><span class="p">,</span>
                        <span class="n">dates</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">Date</span><span class="p">,</span>
                        <span class="n">ntrend</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">deltrend</span><span class="o">=.</span><span class="mi">99</span><span class="p">,</span>
                        <span class="n">nsamps</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">)</span>


<span class="n">forecast</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>beginning forecasting
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">forecast</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(56, 4)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">Date</span> <span class="o">==</span> <span class="n">forecast_start</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">Date</span> <span class="o">==</span> <span class="n">forecast_end</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">Date</span><span class="p">)</span>


<span class="n">forecast</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">)</span>
<span class="n">forecast</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1-Step Ahead&#39;</span><span class="p">,</span> <span class="s1">&#39;2-Step Ahead&#39;</span><span class="p">,</span> <span class="s1">&#39;3-Step Ahead&#39;</span><span class="p">,</span> <span class="s1">&#39;4-Step Ahead&#39;</span><span class="p">]</span>
<span class="n">forecast</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1-Step Ahead</th>
      <th>2-Step Ahead</th>
      <th>3-Step Ahead</th>
      <th>4-Step Ahead</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01</th>
      <td>0.97</td>
      <td>0.89</td>
      <td>0.87</td>
      <td>0.82</td>
    </tr>
    <tr>
      <th>2000-04-01</th>
      <td>0.98</td>
      <td>0.93</td>
      <td>0.87</td>
      <td>0.83</td>
    </tr>
    <tr>
      <th>2000-07-01</th>
      <td>1.07</td>
      <td>0.97</td>
      <td>0.93</td>
      <td>0.92</td>
    </tr>
    <tr>
      <th>2000-10-01</th>
      <td>1.11</td>
      <td>1.05</td>
      <td>1.01</td>
      <td>0.91</td>
    </tr>
    <tr>
      <th>2001-01-01</th>
      <td>1.15</td>
      <td>1.10</td>
      <td>1.05</td>
      <td>0.99</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The forecasts are made on each date <em>before</em> seeing the observation. So the $1-$Step Ahead forecast is projecting the mean for the Date listed in that row. The $2-$Step Ahead forecast is project the mean for the Date listed in the next row, and so on.</p>
<p>This view allows you to easily see the forecasts and how the model projects into the future. Looking across the first row, it is clear that the model has a negative slope, because the forecasts decrease as it projects further into the future.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="median" class="doc_header"><code>median</code><a href="https://github.com/lavinei/pybats_nbdev/tree/master/pybats_nbdev/point_forecast.py#L21" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>median</code>(<strong><code>samps</code></strong>)</p>
</blockquote>
<p>Return the median point forecasts, given samples from the analysis function.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The median point forecast is theoretically optimal for minimizing absolute deviation loss, $\sum_i |y_i - f_i|$.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">forecast</span> <span class="o">=</span> <span class="n">median</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>

<span class="n">forecast</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">)</span>
<span class="n">forecast</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1-Step Ahead&#39;</span><span class="p">,</span> <span class="s1">&#39;2-Step Ahead&#39;</span><span class="p">,</span> <span class="s1">&#39;3-Step Ahead&#39;</span><span class="p">,</span> <span class="s1">&#39;4-Step Ahead&#39;</span><span class="p">]</span>
<span class="n">forecast</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1-Step Ahead</th>
      <th>2-Step Ahead</th>
      <th>3-Step Ahead</th>
      <th>4-Step Ahead</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01</th>
      <td>0.98</td>
      <td>0.88</td>
      <td>0.86</td>
      <td>0.81</td>
    </tr>
    <tr>
      <th>2000-04-01</th>
      <td>0.99</td>
      <td>0.92</td>
      <td>0.90</td>
      <td>0.83</td>
    </tr>
    <tr>
      <th>2000-07-01</th>
      <td>1.04</td>
      <td>0.97</td>
      <td>0.94</td>
      <td>0.92</td>
    </tr>
    <tr>
      <th>2000-10-01</th>
      <td>1.14</td>
      <td>1.07</td>
      <td>0.99</td>
      <td>0.90</td>
    </tr>
    <tr>
      <th>2001-01-01</th>
      <td>1.16</td>
      <td>1.09</td>
      <td>1.06</td>
      <td>0.98</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="m_one_median" class="doc_header"><code>m_one_median</code><a href="https://github.com/lavinei/pybats_nbdev/tree/master/pybats_nbdev/point_forecast.py#L41" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>m_one_median</code>(<strong><code>samps</code></strong>)</p>
</blockquote>
<p>Return the (-1)-median point forecasts, given samples from the analysis function.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The $\left(-1\right)-$median is theoretically optimal for minimizing absolute percent error, $\sum_i |y_i - f_i|/y_i$. It is always lower than the median, and is only defined for non-zero $y$. We'll use a different example, because the $(-1)-$median can produce strange results when $y_i$ is close to $0$.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pybats_nbdev.shared</span> <span class="kn">import</span> <span class="n">load_sales_example</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">load_sales_example</span><span class="p">()</span>             

<span class="n">Y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Advertising&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">k</span> <span class="o">=</span> <span class="mi">4</span>                                               
<span class="n">forecast_start</span> <span class="o">=</span> <span class="mi">15</span>                                
<span class="n">forecast_end</span> <span class="o">=</span> <span class="mi">30</span>                               

<span class="n">mod</span><span class="p">,</span> <span class="n">samples</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s2">&quot;poisson&quot;</span><span class="p">,</span>
                        <span class="n">forecast_start</span><span class="o">=</span><span class="n">forecast_start</span><span class="p">,</span> <span class="n">forecast_end</span><span class="o">=</span><span class="n">forecast_end</span><span class="p">,</span>
                        <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">prior_length</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                        <span class="n">rho</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">deltrend</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">delregn</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>beginning forecasting
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">forecast</span> <span class="o">=</span> <span class="n">m_one_median</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>

<span class="n">forecast</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">forecast</span><span class="p">)</span>
<span class="n">forecast</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1-Step Ahead&#39;</span><span class="p">,</span> <span class="s1">&#39;2-Step Ahead&#39;</span><span class="p">,</span> <span class="s1">&#39;3-Step Ahead&#39;</span><span class="p">,</span> <span class="s1">&#39;4-Step Ahead&#39;</span><span class="p">]</span>
<span class="n">forecast</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1-Step Ahead</th>
      <th>2-Step Ahead</th>
      <th>3-Step Ahead</th>
      <th>4-Step Ahead</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>76.0</td>
      <td>72.0</td>
      <td>51.0</td>
      <td>50.5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>65.0</td>
      <td>44.0</td>
      <td>46.0</td>
      <td>38.5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>37.0</td>
      <td>38.0</td>
      <td>33.0</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>40.0</td>
      <td>34.0</td>
      <td>30.5</td>
      <td>23.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>31.0</td>
      <td>28.0</td>
      <td>21.5</td>
      <td>19.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

