---

title: Define Models

keywords: fastai
sidebar: home_sidebar

summary: "This module contains helper functions to define a DGLM. The function accepts the first several observations in a time series, and automatically initialized the model and coefficients based upon those values."
description: "This module contains helper functions to define a DGLM. The function accepts the first several observations in a time series, and automatically initialized the model and coefficients based upon those values."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/03_define_models.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Define-a-DGLM">Define a DGLM<a class="anchor-link" href="#Define-a-DGLM"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="define_dglm" class="doc_header"><code>define_dglm</code><a href="https://github.com/lavinei/pybats_nbdev/tree/master/pybats_nbdev/define_models.py#L17" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>define_dglm</code>(<strong><code>Y</code></strong>, <strong><code>X</code></strong>, <strong><code>family</code></strong>=<em><code>'normal'</code></em>, <strong><code>n</code></strong>=<em><code>None</code></em>, <strong><code>ntrend</code></strong>=<em><code>1</code></em>, <strong><code>nlf</code></strong>=<em><code>0</code></em>, <strong><code>nhol</code></strong>=<em><code>0</code></em>, <strong><code>seasPeriods</code></strong>=<em><code>[7]</code></em>, <strong><code>seasHarmComponents</code></strong>=<em><code>[[1, 2, 3]]</code></em>, <strong><code>deltrend</code></strong>=<em><code>0.995</code></em>, <strong><code>delregn</code></strong>=<em><code>0.995</code></em>, <strong><code>delseas</code></strong>=<em><code>0.999</code></em>, <strong><code>dellf</code></strong>=<em><code>0.999</code></em>, <strong><code>delVar</code></strong>=<em><code>0.999</code></em>, <strong><code>delhol</code></strong>=<em><code>1</code></em>, <strong><code>n0</code></strong>=<em><code>1</code></em>, <strong><code>s0</code></strong>=<em><code>1</code></em>, <strong><code>a0</code></strong>=<em><code>None</code></em>, <strong><code>R0</code></strong>=<em><code>None</code></em>, <strong><code>adapt_discount</code></strong>=<em><code>'info'</code></em>, <strong><code>discount_forecast</code></strong>=<em><code>False</code></em>, <strong><code>prior_length</code></strong>=<em><code>None</code></em>, <strong><code>return_aR</code></strong>=<em><code>False</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>A helper function to define a DGLM.</p>
<p>This function is especially useful if you do not know how to specifify a prior mean and variance (a0, R0) for the state vector.</p>
<p>.. code::</p>

<pre><code>mod = define_dglm(Y, X, family='poisson',       # Observation vector Y, regression predictors X, and the exponential family.
                  prior_length=21,              # Number of observations to use in defining prior
                  ntrend=1,                     # Number of 'trend' or polynomial components. 1=intercept (local level). 2=intercept and local slope.
                  nhol=0,                       # Number of holiday indicators in the model. These are regression components.
                  seasPeriods=[7],              # List of the periods of seasonal components. This includes a seasonal component with period 7, which is typical for day-of-week seasonality.
                  seasHarmComponents=[[1,2,3]]  # List of harmonic components for each seasonal component. These components go up to period/2, rounded down. So we include the 1st, 2nd, and 3rd component for a seasonality with period 7.
                  )

</code></pre>
<p>This function is called automatically within 'analysis' if a model prior is not specified.</p>
<p>:param Y: Observation array used to define prior
:param X: Predictor array used to define prior (includes indicator columns for holidays)
:param ntrend: Number of trend components. 1 = Intercept only. 2 = Intercept + slope
:param nhol: Number of holiday components
:param seasPeriods: List of periods for seasonal components
:param seasHarmComponents: List of harmonic components included in each seasonal component
:param deltrend: Discount factor on trend components
:param delregn: Discount factor on regression components
:param delseas: Discount factor on seasonal components
:param delVar: Discount factor on stochastic volatility (observation error)
:param delhol: Discount factor on holiday components
:param n0: Prior 'sample size' for stochastic volatility
:param s0: Prior standard deviation of stochastic volatility
:param a0: Prior state vector mean
:param R0: Prior state vector covariance
:param adapt_discount: Optional. Can be 'info' or 'positive_regn'. Ways to adapt discount factors, and prevent exploding variance.
:param discount_forecast: Optional, boolean. Should forecasts be discounted? If yes, variance added to state vector with state evolution equation.
:param prior_length: Optional, number of rows from Y, X to use. Otherwise all are used
:param kwargs:
:return: Returns an initialized DGLM</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="define_dlm_params" class="doc_header"><code>define_dlm_params</code><a href="https://github.com/lavinei/pybats_nbdev/tree/master/pybats_nbdev/define_models.py#L195" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>define_dlm_params</code>(<strong><code>Y</code></strong>, <strong><code>X</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="define_bern_params" class="doc_header"><code>define_bern_params</code><a href="https://github.com/lavinei/pybats_nbdev/tree/master/pybats_nbdev/define_models.py#L208" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>define_bern_params</code>(<strong><code>Y</code></strong>, <strong><code>X</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="define_bin_params" class="doc_header"><code>define_bin_params</code><a href="https://github.com/lavinei/pybats_nbdev/tree/master/pybats_nbdev/define_models.py#L235" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>define_bin_params</code>(<strong><code>Y</code></strong>, <strong><code>n</code></strong>, <strong><code>X</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="define_pois_params" class="doc_header"><code>define_pois_params</code><a href="https://github.com/lavinei/pybats_nbdev/tree/master/pybats_nbdev/define_models.py#L258" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>define_pois_params</code>(<strong><code>Y</code></strong>, <strong><code>X</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="define_dcmm" class="doc_header"><code>define_dcmm</code><a href="https://github.com/lavinei/pybats_nbdev/tree/master/pybats_nbdev/define_models.py#L291" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>define_dcmm</code>(<strong><code>Y</code></strong>, <strong><code>X</code></strong>, <strong><code>ntrend</code></strong>=<em><code>1</code></em>, <strong><code>nlf</code></strong>=<em><code>0</code></em>, <strong><code>nhol</code></strong>=<em><code>0</code></em>, <strong><code>rho</code></strong>=<em><code>1</code></em>, <strong><code>seasPeriods</code></strong>=<em><code>[7]</code></em>, <strong><code>seasHarmComponents</code></strong>=<em><code>[[1, 2, 3]]</code></em>, <strong><code>deltrend_bern</code></strong>=<em><code>0.995</code></em>, <strong><code>delregn_bern</code></strong>=<em><code>0.995</code></em>, <strong><code>delseas_bern</code></strong>=<em><code>0.995</code></em>, <strong><code>dellf_bern</code></strong>=<em><code>0.999</code></em>, <strong><code>delhol_bern</code></strong>=<em><code>1</code></em>, <strong><code>deltrend_pois</code></strong>=<em><code>0.998</code></em>, <strong><code>delregn_pois</code></strong>=<em><code>0.995</code></em>, <strong><code>delseas_pois</code></strong>=<em><code>0.995</code></em>, <strong><code>dellf_pois</code></strong>=<em><code>0.999</code></em>, <strong><code>delhol_pois</code></strong>=<em><code>1</code></em>, <strong><code>a0_bern</code></strong>=<em><code>None</code></em>, <strong><code>R0_bern</code></strong>=<em><code>None</code></em>, <strong><code>a0_pois</code></strong>=<em><code>None</code></em>, <strong><code>R0_pois</code></strong>=<em><code>None</code></em>, <strong><code>interpolate</code></strong>=<em><code>True</code></em>, <strong><code>adapt_discount</code></strong>=<em><code>False</code></em>, <strong><code>prior_length</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>:param Y: Observation array used to define prior
:param X: Predictor array used to define prior
:param ntrend: Number of trend components. 1 = Intercept only. 2 = Intercept + slope
:param nlf: Number of latent factor components
:param nhol: Number of holiday components
:param rho: Discount factor for random effects extension in poisson DGLM (smaller rho increases variance)
:param seasPeriods: List of periods for seasonal components
:param seasHarmComponents: List of harmonic components included in each seasonal component
:param deltrend_bern: Discount factor on trend components of Bernoulli DGLM
:param delregn_bern: Discount factor on regression components of Bernoulli DGLM
:param delseas_bern: Discount factor on seasonal components of Bernoulli DGLM
:param dellf_bern: Discount factor on latent factor components of Bernoulli DGLM
:param delhol_bern: Discount factor on holiday components of Bernoulli DGLM
:param deltrend_pois: Discount factor on trend components of Poisson DGLM
:param delregn_pois: Discount factor on regression components of Poisson DGLM
:param delseas_pois: Discount factor on seasonal components of Poisson DGLM
:param dellf_pois: Discount factor on latent factor components of Poisson DGLM
:param delhol_pois: Discount factor on holiday components of Poisson DGLM
:param a0_bern: Prior state vector mean of Bernoulli DGLM
:param R0_bern: Prior state vector covariance of Bernoulli DGLM
:param a0_pois: Prior state vector mean of Poisson DGLM
:param R0_pois: Prior state vector covariance of Poisson DGLM
:param interpolate: Bool. Interpolate in Variational Bayes step for DGLM inference, for computational speedup.
:param adapt_discount: Optional. Can be 'info' or 'positive_regn'. Ways to adapt discount factors, and prevent exploding variance.
:param prior_length: Optional, number of rows from Y, X to use. Otherwise all are used
:param kwargs:
:return: An initialized DCMM</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="define_dbcm" class="doc_header"><code>define_dbcm</code><a href="https://github.com/lavinei/pybats_nbdev/tree/master/pybats_nbdev/define_models.py#L369" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>define_dbcm</code>(<strong><code>Y_transaction</code></strong>, <strong><code>X_transaction</code></strong>=<em><code>None</code></em>, <strong><code>Y_cascade</code></strong>=<em><code>None</code></em>, <strong><code>X_cascade</code></strong>=<em><code>None</code></em>, <strong><code>excess_baskets</code></strong>=<em><code>[]</code></em>, <strong><code>excess_values</code></strong>=<em><code>[]</code></em>, <strong><code>ntrend</code></strong>=<em><code>1</code></em>, <strong><code>nlf</code></strong>=<em><code>0</code></em>, <strong><code>nhol</code></strong>=<em><code>0</code></em>, <strong><code>rho</code></strong>=<em><code>1</code></em>, <strong><code>seasPeriods</code></strong>=<em><code>[7]</code></em>, <strong><code>seasHarmComponents</code></strong>=<em><code>[[1, 2, 3]]</code></em>, <strong><code>deltrend_bern</code></strong>=<em><code>0.995</code></em>, <strong><code>delregn_bern</code></strong>=<em><code>0.995</code></em>, <strong><code>delseas_bern</code></strong>=<em><code>0.995</code></em>, <strong><code>dellf_bern</code></strong>=<em><code>0.999</code></em>, <strong><code>delhol_bern</code></strong>=<em><code>1</code></em>, <strong><code>deltrend_pois</code></strong>=<em><code>0.998</code></em>, <strong><code>delregn_pois</code></strong>=<em><code>0.995</code></em>, <strong><code>delseas_pois</code></strong>=<em><code>0.995</code></em>, <strong><code>dellf_pois</code></strong>=<em><code>0.999</code></em>, <strong><code>delhol_pois</code></strong>=<em><code>1</code></em>, <strong><code>deltrend_cascade</code></strong>=<em><code>0.999</code></em>, <strong><code>delregn_cascade</code></strong>=<em><code>1.0</code></em>, <strong><code>delseas_cascade</code></strong>=<em><code>0.999</code></em>, <strong><code>dellf_cascade</code></strong>=<em><code>0.999</code></em>, <strong><code>delhol_cascade</code></strong>=<em><code>1.0</code></em>, <strong><code>a0_bern</code></strong>=<em><code>None</code></em>, <strong><code>R0_bern</code></strong>=<em><code>None</code></em>, <strong><code>a0_pois</code></strong>=<em><code>None</code></em>, <strong><code>R0_pois</code></strong>=<em><code>None</code></em>, <strong><code>a0_cascade</code></strong>=<em><code>None</code></em>, <strong><code>R0_cascade</code></strong>=<em><code>None</code></em>, <strong><code>interpolate</code></strong>=<em><code>True</code></em>, <strong><code>adapt_discount</code></strong>=<em><code>False</code></em>, <strong><code>prior_length</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>:param Y_transaction: Observation array of transactions used to define prior
:param X_transaction: Predictor array for transactions used to define prior
:param Y_cascade: Observation matrix of basket sizes used to define prior
:param X_cascade: Predictor array for basket sizes used to define prior
:param excess_baskets: Either excess_baskets or excess_values must be defined. Excess baskets is an array of basket sizes
in exactly the same format as the Y_cascade values. Column j indicate number of transactions with more than j items.
:param excess_values: List of excess values. Each element gives excess basket sizes observed on that day.
Most days should be an empty list. Some days may have multiple transactions with excess basket sizes.
:param ntrend: Number of trend components in the DCMM for transactions. 1 = Intercept only. 2 = Intercept + slope
:param nlf: Number of latent factor components in the DCMM for transactions
:param nhol: Number of holiday components in the DCMM for transactions
:param rho: Discount factor for random effects extension in the DCMM for transactions (smaller rho increases variance)
:param seasPeriods: List of periods for seasonal components in the DCMM for transactions
:param seasHarmComponents: List of harmonic components included in each seasonal component in the DCMM for transactions
:param deltrend_bern: Discount factor on trend components of Bernoulli DGLM
:param delregn_bern: Discount factor on regression components of Bernoulli DGLM
:param delseas_bern: Discount factor on seasonal components of Bernoulli DGLM
:param dellf_bern: Discount factor on latent factor components of Bernoulli DGLM
:param delhol_bern: Discount factor on holiday components of Bernoulli DGLM
:param deltrend_pois: Discount factor on trend components of Poisson DGLM
:param delregn_pois: Discount factor on regression components of Poisson DGLM
:param delseas_pois: Discount factor on seasonal components of Poisson DGLM
:param dellf_pois: Discount factor on latent factor components of Poisson DGLM
:param delhol_pois: Discount factor on holiday components of Poisson DGLM
:param deltrend_cascade: Discount factor on trend components of cascade binomial DGLMs
:param delregn_cascade: Discount factor on regression components of cascade binomial DGLMs
:param delseas_cascade: Discount factor on seasonal components of cascade binomial DGLMs
:param dellf_cascade: Discount factor on latent factor components of cascade binomial DGLMs (DEPRECATED)
:param delhol_cascade: Discount factor on holiday components of cascade binomial DGLMs
:param a0_bern: Prior state vector mean of Bernoulli DGLM
:param R0_bern: Prior state vector covariance of Bernoulli DGLM
:param a0_pois: Prior state vector mean of Poisson DGLM
:param R0_pois: Prior state vector covariance of Poisson DGLM
:param interpolate: Bool. Interpolate in Variational Bayes step for DGLM inference, for computational speedup.
:param adapt_discount: Optional. Can be 'info' or 'positive_regn'. Ways to adapt discount factors, and prevent exploding variance.
:param prior_length: Optional, number of rows from Y, X to use. Otherwise all are used
:param kwargs:
:return: An initialized DBCM</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

